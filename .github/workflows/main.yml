name: Build TW DLL

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout TW branch (抓取原作者的 TW 分支)
      uses: actions/checkout@v4
      with:
        # ⬇️ 关键修改在这里 ⬇️
        repository: TheReVeaLz/StellaSora-Tool  # 强制指向原作者的仓库
        ref: tw                               # 强制指定 tw (台湾) 分支
        submodules: recursive                 # 依然要下载依赖

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1.1

    - name: Build Solution
      # 构建命令不变
      run: msbuild StellaSora-Tool.sln /p:Configuration=Release /p:Platform=x64

    - name: Find and Copy DLL (自动搜寻)
      shell: cmd
      run: |
        echo "正在搜索所有生成的 DLL..."
        dir /s /b *.dll
        
        echo "正在把找到的 DLL 复制到最外层..."
        for /r %%i in (*.dll) do copy "%%i" .

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: StellaSora-TW-Cheat  # 改个名字方便区分
        path: "*.dll"
